# Chat Analysis Message
This is the format of the output messages generated by the Dialog Agent when processing files or Message Bus messages.


## Message Bus Publishing Topic
Analysis of Message Bus messages is published on the Message Bus topic:

```
agent/dialog
```

## Fields
Field Name              | Type   | Description
---                     | ---    | ---
header.timestamp | string | Time of processing by Dialog Agent, in ISO 8601 format: YYYY-MM-DDTHH:MM:SS.SSSZ
header.message_type | string | Message type.  Hardcoded to "**event**"
header.version | string | Dialog Agent software version.  Hardcoded to "**1.0**"
msg.experiment_id | string | The experiment id this message is associated with
msg.trial_id | string | The trial id this message is associated with
msg.timestamp | string | same as header.timestamp
msg.source | string | The name of this testbed component. Hardcoded to "**tomcat_textAnalyze**r"
msg.sub_type | string | The subtype of the data.  Hardcoded to "**Event:dialogue_event**"
msg.version | string | Same as header.version
msg.replay_root_id | string | The replay_root_id if being used for the root of a replay.
msg.replay_id | string | The replay_id if being used for a replay.
data.participant_id | string | The participant who generated the message text
data.asr_msg_id | string | A version 4 UUID associated with this message
data.text | string | The text to be processed by the Dialog Agent
data.utterance_source.source_type | string | File or Message Bus
data.utterance_source.source_name |string | A filename or Message Bus topic
data.extractions | Seq[Extraction] | Analysis of message text

## Extraction Fields
Field Name              | Type   | Description
---                     | ---    | ---
span | string | The substring of data.text corresponding to the extraction.
labels | string array | All labels applied to the span by the rule-based system, in ascending order of their place on the taxonomy hierarchy - i.e., from specific to general.
arguments | map[string, extractions] | Recursive event arguments
start_offset | int | the starting index of the span in the data text
end_offset | int | The ending index of the span in the data text


## Example

```json
{
  "header": {
    "timestamp": "2021-10-07T18:27:42.843Z",
    "message_type": "event",
    "version": "1.1"
  },
  "msg": {
    "experiment_id": "367624f8-81cd-4661-a03f-b61908c39581",
    "trial_id": "78822ceb-448a-436e-a1f1-f154f2066261",
    "timestamp": "2021-10-07T18:27:42.843Z",
    "source": "tomcat_textAnalyzer",
    "sub_type": "Event:dialogue_event",
    "version": "3.0.1",
    "replay_root_id": "",
    "replay_id": ""
  },
  "data": {
    "participant_id": "P00012",
    "asr_msg_id": "bc36d1aa-25e6-11ec-ab58-7831c1b845fe",
    "text": "I'm going to room 204.",
    "dialog_act_label": "Statement",
    "utterance_source": {
      "source_type": "message_bus",
      "source_name": "agent/asr/final"
    },
    "extractions": [
      {
        "labels": [
          "MoveTo",
          "Move",
          "SimpleActions",
          "Action",
          "EventLike",
          "Concept"
        ],
        "span": "going to room 204",
        "arguments": {
          "target": [
            {
              "labels": [
                "NumberedRoom",
                "Room",
                "Infrastructure",
                "Location",
                "EventLike",
                "Concept"
              ],
              "span": "room 204",
              "arguments": {
                "number": [
                  {
                    "labels": [
                      "Number",
                      "Concept"
                    ],
                    "span": "204",
                    "arguments": {},
                    "attachments": [],
                    "start_offset": 18,
                    "end_offset": 21,
                    "rule": "numbers"
                  }
                ]
              },
              "attachments": [],
              "start_offset": 13,
              "end_offset": 21,
              "rule": "room_numbered"
            }
          ]
        },
        "attachments": [
          "{\"text\":\"I\",\"agentType\":\"Self\",\"labels\":[\"Self\",\"Entity\",\"Concept\"],\"span\":[0]}"
        ],
        "start_offset": 4,
        "end_offset": 21,
        "rule": "move_nmod_action"
      },
      {
        "labels": [
          "NumberedRoom",
          "Room",
          "Infrastructure",
          "Location",
          "EventLike",
          "Concept"
        ],
        "span": "room 204",
        "arguments": {
          "number": [
            {
              "labels": [
                "Number",
                "Concept"
              ],
              "span": "204",
              "arguments": {},
              "attachments": [],
              "start_offset": 18,
              "end_offset": 21,
              "rule": "numbers"
            }
          ]
        },
        "attachments": [],
        "start_offset": 13,
        "end_offset": 21,
        "rule": "room_numbered"
      },
      {
        "labels": [
          "Room",
          "Infrastructure",
          "Location",
          "EventLike",
          "Concept"
        ],
        "span": "room",
        "arguments": {},
        "attachments": [],
        "start_offset": 13,
        "end_offset": 17,
        "rule": "room_detection"
      }
    ]
  }
}
```
