version: '3.7'

networks:
  malmonet2:
   external: true    
    
services:
  malmocontrol2:    
    image: malmocontrol:latest
    build: ./MalmoControl/.
    ports: 
      - "5004:5002"
    volumes:
      - //var/run/docker.sock:/var/run/docker.sock
    container_name: malmocontrol2
    networks: 
     - malmonet2
    

  malmo-server2:    
    image: malmoserver:latest
    build: ./MalmoContainer/.
    ports:
      - "5902:5900"              
    depends_on:
      - malmocontrol2      
    container_name: malmo-server2
    volumes:
      - ./MalmoContainer/MQTTClient/config.json:/home/malmo/MalmoPlatform/build/install/Python_Examples/MQTTClient/config.json
    networks: 
     - malmonet2
    environment:
     - MALMO_INSTANCE=2

  # pmengine2:
  #   image: "pmengine:latest"
  #   build: ./PMEContainer
  #   container_name: pmengine2
  #   networks: 
  #   - malmonet2

  # accesscontrol2:
  #   image: "accesscontrol:latest"
  #   build: ./AccessControlContainer/.
  #   container_name: accesscontrol2
  #   environment:
  #   - ASPNETCORE_URLS=https://+:5000
  #   - Kestrel__Certificates__Default__Path=cert-aspnetcore.pfx
  #   - Kestrel__Certificates__Default__Password=password
  #   - Logging:Console:LogLevel:Default=Information
  #   networks: 
  #   - malmonet2
        
  # dashboardservice2:
  #   image: "dashboardservice:latest"
  #   container_name: dashboardservice2
  #   environment:
  #   - ASPNETCORE_URLS=https://+:5005
  #   - Kestrel__Certificates__Default__Path=cert-aspnetcore.pfx
  #   - Kestrel__Certificates__Default__Password=password
  #   - Logging:Console:LogLevel:Default=Information
  #   - ClientServerURL=https://localhost:9000/DashboardService/
  #   - authentication:IdentityServerBaseUrl=https://accesscontrol:5000
  #   - authentication:ClientIdentityServerBaseUrl=https://localhost:9000/AccessControl
  #   - authentication:IgnoreSSLErrors=true
  #   - MQTTSettings:Host=10.150.0.3
  #   - MQTTSettings:Port=1883
  #   networks: 
  #   - malmonet2
        
  # nginx2:
  #   image: nginx:alpine
  #   container_name: nginx2
  #   volumes:
  #   -  ./PMEContainer/PerformanceDashboard:/usr/share/nginx/html/PerformanceDashboard
  #   -  ./PMEContainer/MeasureConfig:/usr/share/nginx/html/measureconfig
  #   -  ./PMEContainer/Workbench:/usr/share/nginx/html/workbench
  #   -  ./PMEContainer/Diagnostics:/usr/share/nginx/html/diagnostics
  #   -  ./PMEContainer/Settings/PerformanceDashboardSettings.json:/usr/share/nginx/html/PerformanceDashboard/assets/settings.json
  #   -  ./PMEContainer/Settings/nginx.conf:/etc/nginx/nginx.conf
  #   -  ./PMEContainer/Settings/cert-aspnetcore.crt:/etc/nginx/cert-aspnetcore.crt
  #   -  ./PMEContainer/Settings/cert-aspnetcore.key:/etc/nginx/cert-aspnetcore.key
  #   -  ./PMEContainer/Settings/ssl_passwords.txt:/etc/nginx/ssl_passwords.txt
  #   ports:
  #   - "9002:443"    
  #   networks: 
  #   - malmonet2
        
    