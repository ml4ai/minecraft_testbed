input {
  dead_letter_queue {
    path => "/usr/share/logstash/data/dead_letter_queue/"
	pipeline_id => "mqtt"
  }
}

filter {
  mutate {
	add_field => {
	  "[error][data]" => "%{data}"
      "[error][reason]" => "%{[@metadata][dead_letter_queue][reason]}"
      "[error][plugin_id]" => "%{[@metadata][dead_letter_queue][plugin_id]}"
      "[error][plugin_type]" => "%{[@metadata][dead_letter_queue][plugin_type]}"
      "[error][entry_time]" => "%{[@metadata][dead_letter_queue][entry_time]}"
    }
	remove_field => [ "data" ]
  }
}

output {
  elasticsearch {
    hosts    => [ 'elasticsearch' ]
	template_overwrite => true
	template           => '/usr/share/logstash/plugins/elasticsearch/es-mapping.json'
  }
}